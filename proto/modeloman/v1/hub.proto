syntax = "proto3";

package modeloman.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";

// ModeloManHub is the canonical RPC surface for orchestration-state management.
//
// Notes:
// - This contract intentionally uses google.protobuf.Struct/ListValue for bring-up speed
//   while still staying fully gRPC/protobuf-native.
// - Request/response JSON shapes are documented in docs/protobuf-contract.md.
// - Once protoc/buf are available in your environment, you can migrate these Struct-based
//   payloads to typed messages incrementally without changing transport semantics.
service ModeloManHub {
  // Liveness + service metadata.
  rpc GetHealth(google.protobuf.Empty) returns (google.protobuf.Struct);

  // Aggregate counters and economic totals (tokens/cost/provider split).
  rpc GetSummary(google.protobuf.Empty) returns (google.protobuf.Struct);

  // Full persisted state export.
  rpc ExportState(google.protobuf.Empty) returns (google.protobuf.Struct);

  // Create a task.
  rpc CreateTask(google.protobuf.Struct) returns (google.protobuf.Struct);

  // Update task fields.
  rpc UpdateTask(google.protobuf.Struct) returns (google.protobuf.Struct);

  // Delete task by id.
  rpc DeleteTask(google.protobuf.Struct) returns (google.protobuf.Struct);

  // List all tasks sorted by updated_at descending.
  rpc ListTasks(google.protobuf.Empty) returns (google.protobuf.ListValue);

  // Create a note.
  rpc CreateNote(google.protobuf.Struct) returns (google.protobuf.Struct);

  // List all notes sorted by created_at descending.
  rpc ListNotes(google.protobuf.Empty) returns (google.protobuf.ListValue);

  // Append a changelog entry.
  rpc AppendChangelog(google.protobuf.Struct) returns (google.protobuf.Struct);

  // List changelog entries sorted by created_at descending.
  rpc ListChangelog(google.protobuf.Empty) returns (google.protobuf.ListValue);

  // Record benchmark telemetry for model/provider usage.
  rpc RecordBenchmark(google.protobuf.Struct) returns (google.protobuf.Struct);

  // List benchmarks sorted by created_at descending.
  rpc ListBenchmarks(google.protobuf.Empty) returns (google.protobuf.ListValue);

  // Start a tracked orchestrator run.
  rpc StartRun(google.protobuf.Struct) returns (google.protobuf.Struct);

  // Mark a run completed/failed/cancelled and finalize aggregates.
  rpc FinishRun(google.protobuf.Struct) returns (google.protobuf.Struct);

  // List tracked runs sorted by started_at descending (supports optional filters).
  rpc ListRuns(google.protobuf.Struct) returns (google.protobuf.ListValue);

  // Record one prompt/model attempt inside a run.
  rpc RecordPromptAttempt(google.protobuf.Struct) returns (google.protobuf.Struct);

  // List prompt attempts (optional run_id filter in request struct).
  rpc ListPromptAttempts(google.protobuf.Struct) returns (google.protobuf.ListValue);

  // Record arbitrary run lifecycle event (step transitions, warnings, errors).
  rpc RecordRunEvent(google.protobuf.Struct) returns (google.protobuf.Struct);

  // List run events (optional run_id filter in request struct).
  rpc ListRunEvents(google.protobuf.Struct) returns (google.protobuf.ListValue);

  // Aggregate telemetry summary across runs/attempts/events.
  rpc GetTelemetrySummary(google.protobuf.Empty) returns (google.protobuf.Struct);

  // Read active orchestration policy (budget guard + kill switch).
  rpc GetPolicy(google.protobuf.Empty) returns (google.protobuf.Struct);

  // Update active orchestration policy.
  rpc SetPolicy(google.protobuf.Struct) returns (google.protobuf.Struct);

  // Prompt leaderboard across attempts.
  rpc GetLeaderboard(google.protobuf.Struct) returns (google.protobuf.ListValue);

  // List all active/inactive provider/model cap rules.
  rpc ListPolicyCaps(google.protobuf.Empty) returns (google.protobuf.ListValue);

  // Create or update a provider/model cap rule.
  rpc UpsertPolicyCap(google.protobuf.Struct) returns (google.protobuf.Struct);

  // Delete a provider/model cap rule by id.
  rpc DeletePolicyCap(google.protobuf.Struct) returns (google.protobuf.Struct);
}
